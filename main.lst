ca65 V2.19 - Git b1e1c13d4
Main file   : ./src/main.asm
Current file: ./src/main.asm

000000r 1               .INCLUDE "macros.inc"
000000r 2               ;MACRO LOAD_FILE (FILE LENGTH),(<FILE NAME),(>FILE NAME),(<LOAD LOCATION),(>LOAD LOCATION),(^LOAD LOCATION)
000000r 2               .MACRO LOAD_FILE LENGTH,X_NAME,Y_NAME,X_LOCATION,Y_LOCATION,A_LOCATION
000000r 2               	LDA LENGTH	;LENGTH OF FILE NAME
000000r 2               	LDX X_NAME
000000r 2               	LDY Y_NAME
000000r 2               	JSR $FFBD	;SETNAM A=FILE NAME LENGTH X/Y=POINTER TO FILENAME
000000r 2               	LDA #$02
000000r 2               	LDX #$08
000000r 2               	LDY #$00
000000r 2               	JSR $FFBA	;SETFLS A=LOGICAL NUMBER X=DEVICE NUMBER Y=SECONDARY
000000r 2               	LDX X_LOCATION
000000r 2               	LDY Y_LOCATION
000000r 2               	LDA A_LOCATION	;LOAD FILE INTO A=1 RAM, A=2 VRAM FOR $0:0000, A=3 VRAM FOR $1:0000
000000r 2               	JSR $FFD5	;LOAD FILE FOR LOAD X/Y=LOAD ADDRESS
000000r 2               	LDA #$02
000000r 2               	JSR $FFC3	;CLOSE FILE
000000r 2               .ENDMACRO
000000r 2               
000000r 2               ;MACRO SET_VERA_ADDR X = VERA_L, Y = VERA_M, A = VERA_H
000000r 2               .MACRO SET_VERA_ADDR
000000r 2               	STX $9F20
000000r 2               	STY $9F21
000000r 2               	STA $9F22
000000r 2               .ENDMACRO
000000r 2               
000000r 1               .SEGMENT "LOADADDR"
000000r 1  01 08        	.WORD $0801
000002r 1               .SEGMENT "BASICSTUB"
000000r 1  rr rr        	.WORD START-2
000002r 1  00 00 9E     	.BYTE $00,$00,$9E
000005r 1  32 30 36 31  	.BYTE "2061"
000009r 1  00 00 00     	.BYTE $00,$00,$00
00000Cr 1               .SEGMENT "STARTUP"
000000r 1               START:
000000r 1  4C rr rr     	JMP MAIN
000003r 1               .SEGMENT "CODE"
000000r 1               
000000r 1               IRQVEC = $0314
000000r 1               
000000r 1               VERA_L			= $9F20
000000r 1               VERA_M			= $9F21
000000r 1               VERA_H			= $9F22
000000r 1               VERA_DATA		= $9F23
000000r 1               VIDEO_CONFIG	= $9F29
000000r 1               VERA_IEN 		= $9F26
000000r 1               VERA_ISR 		= $9F27
000000r 1               L0_CONFIG 		= $9F2D
000000r 1               L0_MAPBASE		= $9F2E
000000r 1               L0_TILEBASE		= $9F2F
000000r 1               L0_LHSCROLL		= $9F30
000000r 1               L0_HHSCROLL		= $9F31
000000r 1               L0_LVSCROLL		= $9F32
000000r 1               L0_HVSCROLL		= $9F33
000000r 1               L1_CONFIG 		= $9F34
000000r 1               L1_MAPBASE 		= $9F35
000000r 1               L1_TILEBASE		= $9F36
000000r 1               L1_LHSCROLL		= $9F37
000000r 1               L1_HHSCROLL		= $9F38
000000r 1               L1_LVSCROLL		= $9F39
000000r 1               L1_HVSCROLL		= $9F3A
000000r 1               GET_INPUT		= $FFE4
000000r 1               MOUSE_CONFIG	= $FF68
000000r 1               MOUSE_GET		= $FF6B
000000r 1               
000000r 1               MAIN:
000000r 1  20 rr rr     	JSR SETUP_VERA
000003r 1  20 rr rr     	JSR LOAD_GRAPHICS
000006r 1  20 rr rr     	JSR LOAD_SPRITES
000009r 1  60           	RTS
00000Ar 1               SETUP_VERA:
00000Ar 1  A9 71        	LDA #%01110001	;ENABLE SPRITES, LAYER_0, LAYER_1, AND SET TO VGA MODE
00000Cr 1  8D 29 9F     	STA VIDEO_CONFIG
00000Fr 1  A9 62        	LDA #%01100010	;MAP HEIGHT/WIDTH 128X64 WITH 16 COLORS
000011r 1  8D 2D 9F     	STA L0_CONFIG
000014r 1  8D 34 9F     	STA L1_CONFIG
000017r 1  A9 00        	LDA #$00		;MAP 0 STORED AT $0:0000
000019r 1  8D 2E 9F     	STA L0_MAPBASE
00001Cr 1  A9 20        	LDA #$20		;MAP 1 STORED AT $0:4000
00001Er 1  8D 35 9F     	STA L1_MAPBASE
000021r 1  A9 43        	LDA #%01000011	;TILES STORED AT $1:0000
000023r 1  8D 2F 9F     	STA L0_TILEBASE
000026r 1  8D 36 9F     	STA L1_TILEBASE
000029r 1  A9 05        	LDA #%00000101	;ENABLE VSYNC AND SPRITE COLLISION INTERRUPTS
00002Br 1  8D 26 9F     	STA VERA_IEN
00002Er 1  A9 40        	LDA #64			;SCALES THE SCREEN SIZE
000030r 1  8D 2A 9F     	STA $9F2A
000033r 1  8D 2B 9F     	STA $9F2B
000036r 1  A9 01        	LDA #1
000038r 1  A2 40        	LDX #64
00003Ar 1  A0 40        	LDY #64
00003Cr 1  20 68 FF     	JSR MOUSE_CONFIG	;SETS UP THE MOUSE CURSOR
00003Fr 1  60           	RTS
000040r 1  4D 41 50 30  MAP_0_FILE:	.BYTE "map0.bin"
000044r 1  2E 42 49 4E  
000048r 1  4D 41 50 31  MAP_1_FILE:	.BYTE "map1.bin"
00004Cr 1  2E 42 49 4E  
000050r 1  54 49 4C 45  TILE_FILE:	.BYTE "tiles.bin"
000054r 1  53 2E 42 49  
000058r 1  4E           
000059r 1  53 50 52 49  SPRITE_FILE:.BYTE "sprite0.bin"
00005Dr 1  54 45 30 2E  
000061r 1  42 49 4E     
000064r 1  50 41 4C 2E  PALLETE_FILE:.BYTE "pal.bin"
000068r 1  42 49 4E     
00006Br 1               LOAD_GRAPHICS:
00006Br 1               	;MACRO LOAD_FILE (FILE LENGTH),(<FILE NAME),(>FILE NAME),(<LOAD LOCATION),(>LOAD LOCATION),(^LOAD LOCATION)
00006Br 1  A9 08 A2 rr  	LOAD_FILE #8,#<MAP_0_FILE,#>MAP_0_FILE,#$00,#$00,#$02			;LOAD MAP 0 TO $0:0000
00006Fr 1  A0 rr 20 BD  
000073r 1  FF A9 02 A2  
00008Br 1  A9 08 A2 rr  	LOAD_FILE #8,#<MAP_1_FILE,#>MAP_1_FILE,#$00,#$40,#$02			;LOAD MAP 1 TO $0:4000
00008Fr 1  A0 rr 20 BD  
000093r 1  FF A9 02 A2  
0000ABr 1  A9 09 A2 rr  	LOAD_FILE #9,#<TILE_FILE,#>TILE_FILE,#$00,#$80,#$02			;LOAD THE TILESET TO $0:8000
0000AFr 1  A0 rr 20 BD  
0000B3r 1  FF A9 02 A2  
0000CBr 1  A9 0B A2 rr  	LOAD_FILE #11,#<SPRITE_FILE,#>SPRITE_FILE,#$00,#$00,#$03	;LOAD SPRITES TO $1:0000
0000CFr 1  A0 rr 20 BD  
0000D3r 1  FF A9 02 A2  
0000EBr 1  A9 07 A2 rr  	LOAD_FILE #7,#<PALLETE_FILE,#>PALLETE_FILE,#$00,#$FA,#$03	;LOAD THE PALLETE TO $1:FA00
0000EFr 1  A0 rr 20 BD  
0000F3r 1  FF A9 02 A2  
00010Br 1  60           	RTS
00010Cr 1               INIT_SPRITES:
00010Cr 1               	;SPRITE 0
00010Cr 1  00           	.BYTE %00000000	;ADDRESS 12:5
00010Dr 1  08           	.BYTE %00001000	;MODE (BIT 7) ADDRESS 16:13 (BITS 3:0)
00010Er 1  00           	.BYTE 00		;X 7:0
00010Fr 1  00           	.BYTE %00000000	;X 9:8
000110r 1  00           	.BYTE 0			;Y 7:0
000111r 1  00           	.BYTE %00000000	;Y 9:8
000112r 1  0C           	.BYTE %00001100
000113r 1  90           	.BYTE %10010000	;HEIGHT, WIDTH, PALLETE OFFSET (BITS 3:0)
000114r 1               	;SPRITE 1
000114r 1  00           	.BYTE %00000000	;ADDRESS 12:5
000115r 1  08           	.BYTE %00001000	;MODE (BIT 7) ADDRESS 16:13 (BITS 3:0)
000116r 1  00           	.BYTE 00		;X 7:0
000117r 1  00           	.BYTE %00000000	;X 9:8
000118r 1  00           	.BYTE 0			;Y 7:0
000119r 1  00           	.BYTE %00000000	;Y 9:8
00011Ar 1  0C           	.BYTE %00001100
00011Br 1  50           	.BYTE %01010000	;HEIGHT, WIDTH, PALLETE OFFSET (BITS 3:0)
00011Cr 1               LOAD_SPRITES:
00011Cr 1  A9 00        	LDA #$00
00011Er 1  8D 20 9F     	STA VERA_L
000121r 1  A9 FC        	LDA #$FC
000123r 1  8D 21 9F     	STA VERA_M
000126r 1  A9 11        	LDA #%00010001
000128r 1  8D 22 9F     	STA VERA_H
00012Br 1  A2 00        	LDX #0
00012Dr 1  BD rr rr 8D  	.REPEAT 8
000131r 1  23 9F E8 BD  
000135r 1  rr rr 8D 23  
000165r 1               	LDA INIT_SPRITES,X
000165r 1               	STA VERA_DATA
000165r 1               	INX
000165r 1               	.ENDREPEAT
000165r 1  60           	RTS
000166r 1  00 00        DEFAULT_IRQ: .ADDR 0
000168r 1               IRQ_HANDLING:
000168r 1               	INIT_IRQ:
000168r 1  AD 14 03     		LDA IRQVEC
00016Br 1  8D rr rr     		STA DEFAULT_IRQ
00016Er 1  AD 15 03     		LDA IRQVEC+1
000171r 1  8D rr rr     		STA DEFAULT_IRQ+1
000174r 1  78           		SEI
000175r 1  A9 rr        		LDA #<CUSTOM_IRQ
000177r 1  8D 14 03     		STA IRQVEC
00017Ar 1  A9 rr        		LDA #>CUSTOM_IRQ
00017Cr 1  8D 15 03     		STA IRQVEC+1
00017Fr 1  58           		CLI
000180r 1  60           		RTS
000181r 1               	CUSTOM_IRQ:
000181r 1  20 rr rr     		JSR VSYNC_IRQ
000184r 1  20 rr rr     		JSR COLLISION_IRQ
000187r 1  6C rr rr     		JMP (DEFAULT_IRQ)
00018Ar 1               	VSYNC_IRQ:
00018Ar 1  AD 27 9F     		LDA VERA_ISR
00018Dr 1  29 01        		AND #$01
00018Fr 1  D0 01        		BNE UPDATE_SCREEN
000191r 1  60           		RTS
000192r 1               	UPDATE_SCREEN:
000192r 1  20 6B FF     		JSR MOUSE_GET
000195r 1  60           		RTS
000196r 1               	COLLISION_IRQ:
000196r 1  29 04        		AND #$04
000198r 1  D0 01        		BNE SPRITE_COLLISION
00019Ar 1  60           		RTS
00019Br 1               	SPRITE_COLLISION:
00019Br 1  60           		RTS
00019Br 1               
